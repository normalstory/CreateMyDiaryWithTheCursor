<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <!-- SEO 기본 -->
    <title>무인상점 편편상회 | 세계과자 · 무인아이스크림 · 뷰티 · 간편식</title>
    <meta name="description" content="편편상회는 무인상점으로 세계과자, 무인아이스크림, 뷰티용품, 간편식 등을 판매하는 일상의 작은 선물 같은 공간입니다. Present is a Present.">
    <meta name="keywords" content="무인상점, 편편상회, 무인아이스크림, 세계과자, 뷰티, 간편식, present is a present, 무인편의점, 간식, 편의점 창업">
    <meta name="author" content="편편상회" />
  
    <!-- Open Graph (SNS 공유용) -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pyeonpyeon.com/" />
    <meta property="og:title" content="무인상점 편편상회 | present is a present" />
    <meta property="og:description" content="세계과자, 무인아이스크림, 뷰티, 간편식까지! 무인상점 편편상회는 일상 속 작은 선물 같은 공간입니다." />
    <meta property="og:image" content="	https://public.readdy.ai/ai/img_res/090ca493480043136506a77337fb80e8.jpg" />
    <meta property="og:site_name" content="편편상회" />
  
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="무인상점 편편상회 | 세계과자 · 뷰티 · 간편식" />
    <meta name="twitter:description" content="편편상회는 무인상점으로 세계과자, 무인아이스크림, 뷰티, 간편식 등을 판매하는 일상의 작은 선물 공간입니다." />
    <meta name="twitter:image" content="https://public.readdy.ai/ai/img_res/090ca493480043136506a77337fb80e8.jpg" />

    <link rel="icon" type="image/x-icon" href="/res/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/res/favicon-32x32.png">

    <!-- style -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(0.95);
            }
        }

        .animate-pulse-delay-0 {
            animation: pulse 2s ease-in-out infinite;
        }

        .animate-pulse-delay-1 {
            animation: pulse 2s ease-in-out 0.5s infinite;
        }

        .animate-pulse-delay-2 {
            animation: pulse 2s ease-in-out 1s infinite;
        }

        /* 카카오맵 기본 닫기 버튼 숨기기 */
        .kakao-map-info-window .close {
            display: none !important;
        }
        
        /* 인포윈도우 내부의 기본 닫기 버튼 숨기기 */
        .kakao-map-info-window .info-window-close {
            display: none !important;
        }
        
        /* 카카오맵 인포윈도우의 모든 기본 닫기 버튼 숨기기 */
        .kakao-map-info-window button[type="button"],
        .kakao-map-info-window .close,
        .kakao-map-info-window .info-window-close,
        .kakao-map-info-window .info-window-close-btn {
            display: none !important;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2cafc04e8b8ef1ab57c1dfe658dff951&libraries=services"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4CAF50',
                        secondary: '#2C3E50',
                        beige: '#F5F0E1',
                        brown: '#D7A86E',
                        yellow: '#F1C40F'
                    },
                    borderRadius: {
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                        'button': '8px'
                    }
                }
            }
        }
    </script>
</head>

<body class="w-[375px] min-h-[762px] mx-auto bg-white">
    <nav class="fixed top-0 w-[375px] z-50 bg-white/95 backdrop-blur-sm border-b">
        <div class="flex items-center justify-between px-4 py-3">
            <div class="font-bold text-xl text-secondary">편편상회 便便商會</div>
            <button class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 !rounded-button">
                파트너 문의
            </button>
        </div>
    </nav>
    <main class="pt-[60px] pb-[80px]">
        <div id="main-content">
            <section class="relative h-[480px] overflow-hidden">
                <div class="swiper-container h-full" id="mainSwiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <img src="https://public.readdy.ai/ai/img_res/a4e2c2dcb0c11b788e21a4afbe6526a3.jpg"
                                class="w-full h-full object-cover" alt="Store Image" />
                            <div class="absolute inset-0 bg-black/30 flex flex-col justify-center px-6">
                                <p class="text-white/80 mb-2 text-sm font-medium">
                                    편편상회, 하루의 쉼표
                                </p>
                                <h1 class="text-3xl font-bold text-white mb-4">
                                    The Present is<br />a Present
                                </h1>
                                <p class="text-white/90 mb-2">
                                    좋은 것보다<br />좋아하는 것을 고르는 공간
                                </p>
                                <p class="text-white/80 text-sm mb-8">
                                    하루를 위로하는<br />작은 쉼표 같은 곳
                                </p>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <img src="https://public.readdy.ai/ai/img_res/090ca493480043136506a77337fb80e8.jpg"
                                class="w-full h-full object-cover" alt="Products Image" />
                            <div class="absolute inset-0 bg-black/30 flex flex-col justify-center px-6">
                                <p class="text-white/80 mb-2 text-sm font-medium">
                                    소소한 행복
                                </p>
                                <h1 class="text-3xl font-bold text-white mb-4">
                                    내일도 힘내야 하니까<br />오늘은 나를 위한 선물
                                </h1>
                                <p class="text-white/90 mb-2">
                                    좋아하는 걸 고르는 순간<br />오늘이 조금 더 괜찮아져요
                                </p>
                                <p class="text-white/80 text-sm mb-8">
                                    불량식품은 없어요<br />불량한 습관이 있을 뿐
                                </p>
                            </div>
                        </div>

                        <div class="swiper-slide">
                            <img src="https://public.readdy.ai/ai/img_res/7fc2af2d95112a2957f7666fa875f953.jpg"
                                class="w-full h-full object-cover" alt="Communication Image">
                            <div class="absolute inset-0 bg-black/30 flex flex-col justify-center px-6">
                                <p class="text-white/80 mb-2 text-sm font-medium">함께 나누는 소통</p>
                                <h1 class="text-3xl font-bold text-white mb-4">지역사회와 함께<br>성장하는 파트너</h1>
                                <p class="text-white/90 mb-2">이웃과 함께 만드는<br>따뜻한 커뮤니티</p>
                                <p class="text-white/80 text-sm mb-8">지역 주민들의 일상 속<br>소통의 공간이 되겠습니다</p>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <img src="https://public.readdy.ai/ai/img_res/88761fb771b809bf72b8fce2d58499ae.jpg"
                                class="w-full h-full object-cover" alt="Partnership Image">
                            <div class="absolute inset-0 bg-black/30 flex flex-col justify-center px-6">
                                <p class="text-white/80 mb-2 text-sm font-medium">바른 파트너십</p>
                                <h1 class="text-3xl font-bold text-white mb-4">성공적인 창업,<br>든든한 동반자</h1>
                                <p class="text-white/90 mb-2">체계적인 운영 시스템과<br>안정적인 수익 창출</p>
                                <p class="text-white/80 text-sm mb-8">본사의 전폭적인 지원으로<br>함께 성장하는 파트너십</p>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-pagination absolute bottom-8"></div>
                </div>
                <button
                    class="w-[calc(100%-48px)] absolute bottom-8 left-1/2 -translate-x-1/2 py-4 bg-primary text-white font-medium !rounded-button">
                    파트너 상담 신청하기
                </button>
            </section>
            <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
            <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
            <section class="px-4 py-5 bg-white">
                <div class="text-center mb-2">
                  <h2 class="text-3xl font-bold mb-3 relative inline-block">
                    <span class="absolute -top-1 -left-6 text-2xl animate-bounce"
                      >✨</span
                    >
                    The Present is<br />
                    <span class="relative inline-block">
                      a Present
                      <span class="absolute -top-1 -right-6 text-2xl animate-bounce"
                        >✨</span
                      >
                    </span>
                  </h2>
                  <p class="text-pink-600">지금 이 순간이 선물이 되는 공간</p>
                </div>
                <div class="mt-8">
                    <p class="text-black-600 text-sm mb-2 flex items-center gap-3">
                      <span class="text-xl">🏡</span>
                      동네 속 작은 쉼표
                      <br />언제든 가볍게 들러 필요한 걸 채울 수 있는 곳
                    </p>
                </div>
                <div class="mt-8">
                    <p class="text-black-600 text-sm mb-2 flex items-center gap-3">
                      <span class="text-xl">🤝</span>
                      로컬과 함께하는 가게
                      <br />친숙한 브랜드, 익숙한 제품, 그리고 새로운 발견
                    </p>
                </div>
              </section>
            <section id="benefits" class="px-4 py-8 bg-gray-50">
                <h2 class="text-xl font-bold mb-2">편편상회에서 만나는 작은 위로</h2>
                <p class="text-sm text-sky-600 mb-6">
                  ✨ 당신의 하루를 조금 더 특별하게
                </p>
                <div class="space-y-4">
                  <div class="p-4 bg-white rounded-lg shadow-sm">
                    <div class="flex items-center gap-3">
                      <div class="text-2xl">🍦</div>
                      <div>
                        <h3 class="font-medium">시원한 아이스크림</h3>
                        <p class="text-sm text-gray-600">
                          한입 베어 물면 사르르 녹아내리는 달콤한 순간
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="p-4 bg-white rounded-lg shadow-sm">
                    <div class="flex items-center gap-3">
                      <div class="text-2xl">🍞</div>
                      <div>
                        <h3 class="font-medium">갓 구운 빵처럼 포근한 간식</h3>
                        <p class="text-sm text-gray-600">
                          바쁜 하루에도 손쉽게 즐기는 부드러운 한 조각
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="p-4 bg-white rounded-lg shadow-sm">
                    <div class="flex items-center gap-3">
                      <div class="text-2xl">🍫</div>
                      <div>
                        <h3 class="font-medium">달콤한 과자 한 봉지</h3>
                        <p class="text-sm text-gray-600">
                          오늘 하루, 수고한 나에게 작은 보상
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="p-4 bg-white rounded-lg shadow-sm">
                    <div class="flex items-center gap-3">
                      <div class="text-2xl">🥤</div>
                      <div>
                        <h3 class="font-medium">언제든 시원한 음료</h3>
                        <p class="text-sm text-gray-600">
                          냉장고 속 다양한 선택지, 내 취향대로 골라 마시는 즐거움
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            <section class="px-4 py-8 bg-white">
                <h2 class="text-xl font-bold mb-2">편편상회의 약속</h2>
                <p class="text-sm text-sky-600 mb-6">올바른 유통, 바른 가격, 정직한 운영</p>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-beige flex items-center justify-center">
                            <i class="ri-store-3-line text-xl text-brown"></i>
                        </div>
                        <p class="text-sm font-medium">익숙한 공간</p>
                        <p class="text-xs text-gray-500 mt-1">정겨운 동네가게</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-beige flex items-center justify-center">
                            <i class="ri-hand-heart-line text-xl text-brown"></i>
                        </div>
                        <p class="text-sm font-medium">로컬 상생</p>
                        <p class="text-xs text-gray-500 mt-1">지역과 함께 성장</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-beige flex items-center justify-center">
                            <i class="ri-group-line text-xl text-brown"></i>
                        </div>
                        <p class="text-sm font-medium">커뮤니티</p>
                        <p class="text-xs text-gray-500 mt-1">이웃과의 소통</p>
                    </div>
                </div>
            </section>

            <!-- 매장 위치 섹션 -->
            <section class="px-4 py-8 bg-gray-50">
                <h2 class="text-xl font-bold mb-2">편편상회 매장 위치</h2>
                
                <!-- 간소화된 매장 목록 -->
                <div class="mb-6">
                    <div class="flex gap-3">
                        <button onclick="selectStore('복수점')" 
                                class="px-6 py-3 bg-white border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200 font-medium">
                            🍦 복수점
                        </button>
                        <button onclick="selectStore('중촌연구소')" 
                                class="px-6 py-3 bg-white border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200 font-medium">
                            🍭 중촌연구소
                        </button>
                    </div>
                </div>

                <!-- 지도 영역 -->
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div id="map" class="w-full h-80"></div>
                </div>
            </section>
        </div>

        <div id="partnership-content" class="hidden">
            <section id="benefits" class="px-4 py-8 bg-gray-50">
                <h2 class="text-xl font-bold mb-2">편편한 파트너십</h2>
                <p class="text-sm text-gray-600 mb-6">쉽고 안정적인 운영을 위한 본사의 든든한 지원</p>
                <div class="space-y-4">
                    <div class="p-4 bg-white rounded-lg shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 flex items-center justify-center bg-beige rounded-full">
                                <i class="ri-money-dollar-circle-line text-lg text-yellow"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">초기 투자 부담 최소화</h3>
                                <p class="text-sm text-gray-600">합리적인 창업비용과 안정적인 수익구조</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white rounded-lg shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 flex items-center justify-center bg-beige rounded-full">
                                <i class="ri-customer-service-2-line text-lg text-yellow"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">스마트한 운영 시스템</h3>
                                <p class="text-sm text-gray-600">무인 운영으로 효율적인 매장 관리</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white rounded-lg shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 flex items-center justify-center bg-beige rounded-full">
                                <i class="ri-store-2-line text-lg text-yellow"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">로컬 브랜드 파워</h3>
                                <p class="text-sm text-gray-600">지역 밀착형 마케팅 및 상품 구성 지원</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white rounded-lg shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 flex items-center justify-center bg-beige rounded-full">
                                <i class="ri-ice-cream-line text-lg text-yellow"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">기존 매장 관리 서비스</h3>
                                <p class="text-sm text-gray-600">운영 중인 아이스크림 매장 납품 및 위탁 관리</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="guide" class="px-4 py-8 bg-white">
                <h2 class="text-xl font-bold mb-6">파트너 운영 가이드</h2>
                <p class="text-sm text-gray-600 mb-8">더 쉽고 효율적인 운영을 위한 편편상회의 체계적인 지원 시스템을 소개합니다.</p>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="relative overflow-hidden rounded-lg">
                        <img src="https://public.readdy.ai/ai/img_res/4083c283aec6a027663145cdf7316670.jpg"
                            class="w-full h-40 object-cover" alt="Store Layout">
                        <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-3xl mb-2">🏪</div>
                                <h3 class="text-white font-medium">매장 컨설팅</h3>
                            </div>
                        </div>
                    </div>
                    <div class="relative overflow-hidden rounded-lg">
                        <img src="https://public.readdy.ai/ai/img_res/a51e3453c0c8178e98fd1a46e098fde5.jpg"
                            class="w-full h-40 object-cover" alt="Smart System">
                        <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-3xl mb-2">📊</div>
                                <h3 class="text-white font-medium">스마트 운영</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg flex items-start gap-4">
                        <div class="text-2xl">💡</div>
                        <div>
                            <h4 class="font-medium mb-2">전문 컨설팅</h4>
                            <p class="text-sm text-gray-600">입지 분석부터 인테리어, 상품 구성까지 전문가의 맞춤 컨설팅을 제공합니다.</p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg flex items-start gap-4">
                        <div class="text-2xl">🤖</div>
                        <div>
                            <h4 class="font-medium mb-2">AI 운영 시스템</h4>
                            <p class="text-sm text-gray-600">실시간 데이터 분석으로 재고와 매출을 최적화하는 스마트 솔루션을 제공합니다.</p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg flex items-start gap-4">
                        <div class="text-2xl">🤝</div>
                        <div>
                            <h4 class="font-medium mb-2">든든한 파트너십</h4>
                            <p class="text-sm text-gray-600">정기적인 방문 관리와 긴급 지원으로 안정적인 운영을 도와드립니다.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8">
                    <button class="w-full py-4 bg-primary text-white font-medium !rounded-button">
                        파트너 신청하기
                    </button>
                </div>
            </section>
        </div>

        <section id="security-content" class="hidden">
            <!-- 트리플 안심 솔루션 -->
            <section class="px-4 py-8 bg-white">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-3">편편상회의 트리플 안심 솔루션</h2>
                    <p class="text-gray-500">도난 · 화재 · 정전, 미리 예방하고 피해도 보상해주는<br><b>편편상회</b>의 3중 안전망</p>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <!-- 도난 방지 카드 -->
                    <div class="bg-white rounded-lg shadow p-3 border border-blue-100">
                        <div class="flex flex-col items-center text-center">
                            <div class="w-14 h-14 rounded-full bg-blue-50 flex items-center justify-center animate-pulse-delay-0 mb-2">
                                <i class="ri-shield-check-line text-xl text-blue-600"></i>
                            </div>
                            <h3 class="text-sm font-bold text-blue-600 mb-1">도난 안심</h3>
                            <p class="text-xs text-gray-600 mb-1">도난 피해 보상</p>
                            <p class="text-xs font-bold text-red-500">1,000만원</p>
                        </div>
                    </div>

                    <!-- 화재 감지 카드 -->
                    <div class="bg-white rounded-lg shadow p-3 border border-red-100">
                        <div class="flex flex-col items-center text-center">
                            <div class="w-14 h-14 rounded-full bg-red-50 flex items-center justify-center animate-pulse-delay-1 mb-2">
                                <i class="ri-fire-line text-xl text-red-600"></i>
                            </div>
                            <h3 class="text-sm font-bold text-red-600 mb-1">화재 안심</h3>
                            <p class="text-xs text-gray-600 mb-1">화재 피해 보상</p>
                            <p class="text-xs font-bold text-red-500">나와 이웃 1억씩</p>
                        </div>
                    </div>

                    <!-- 정전 대비 카드 //-->
                    <div class="bg-white rounded-lg shadow p-3 border border-yellow-100">
                        <div class="flex flex-col items-center text-center">
                            <div class="w-14 h-14 rounded-full bg-yellow-50 flex items-center justify-center animate-pulse-delay-2 mb-2">
                                <i class="ri-flashlight-line text-xl text-yellow-600"></i>
                            </div>
                            <h3 class="text-sm font-bold text-yellow-600 mb-1">정전 안심</h3>
                            <p class="text-xs text-gray-600 mb-1">정전 피해 보상</p>
                            <p class="text-xs font-bold text-red-500">1,000만원</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 추천 대상 ///-->
            <section class="px-4 py-8 bg-white">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">🙋 이런 분들에게 추천합니다</h2>
                    <p class="text-gray-500">안전한 무인매장 운영에 최적화된, SK쉴더스</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl mb-2">💰</div>
                        <p class="text-sm font-medium mb-1">초기 비용 부담</p>
                        <p class="text-xs text-gray-600">월정액으로 부담 없는 시작</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl mb-2">🚨</div>
                        <p class="text-sm font-medium mb-1">사고 대비 필요</p>
                        <p class="text-xs text-gray-600">24시간 모니터링 지원</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl mb-2">⚡</div>
                        <p class="text-sm font-medium mb-1">빠른 대응 필요</p>
                        <p class="text-xs text-gray-600">전국 설치/AS 네트워크</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl mb-2">🛡️</div>
                        <p class="text-sm font-medium mb-1">실질적인 실손 보상</p>
                        <p class="text-xs text-gray-600">도난/화재/정전 피해 보상</p>
                    </div>
                </div>
            </section>

            <!-- 주요 특징 -->
            <section class="px-4 py-8 bg-gray-50">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">✨ 주요 특징</h2>
                    <p class="text-gray-600">무인매장 운영의 필수 요소를 한 번에</p>
                </div>
                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">🔒</div>
                            <div>
                                <h3 class="font-medium mb-1">스마트 출입통제</h3>
                                <p class="text-sm text-gray-600">신용카드, 삼성페이, LG페이 등 다양한 결제 수단으로 출입 제어</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">📹</div>
                            <div>
                                <h3 class="font-medium mb-1">AI CCTV 시스템</h3>
                                <p class="text-sm text-gray-600">이상 행동 감지, 쓰레기 감지 등 실시간 모니터링</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">📱</div>
                            <div>
                                <h3 class="font-medium mb-1">모바일 앱 연동</h3>
                                <p class="text-sm text-gray-600">실시간 매장 상태 확인 및 원격 제어 가능</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 패키지 선택 -->
            <section class="px-4 py-8 bg-white ">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">🎯 보안 패키지 선택</h2>
                    <p class="text-gray-600">목적에 맞는 최적의 패키지를 선택하세요</p>
                </div>
                
                <!-- 기본 패키지 -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4 border-2 border-blue-500 relative">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-bold mb-2">24시간 관제</h3>
                        <p class="text-gray-600 text-sm">남녀노소 모두 이용 가능한 무인매장</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">출입통제 기기 1대</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">CCTV 4대</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">무인매장 보험 (1천만원)</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">기본 앱 연동</span>
                        </li>
                    </ul>
                    <button onclick="partnerInquiry.showDialog('기본보안')" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        상담 신청하기
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4 border-2 border-blue-500 relative">
                    
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-bold mb-2">출입인증 패키지</h3>
                        <p class="text-gray-600 text-sm">술 담배 등 어른전용 상품도 함께 판매하는 매장</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">출입인증기 1대</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">CCTV 4대</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">무인매장 보험 (1천만원)</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">고급 앱 연동</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">출입 기록 관리</span>
                        </li>
                    </ul>
                    <button onclick="partnerInquiry.showDialog('출입인증')" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        상담 신청하기
                    </button>
                </div>

                <!-- 프리미엄 패키지///// -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-4 border-2 border-blue-500 relative">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-bold mb-2">AI 보안 패키지</h3>
                        <p class="text-gray-600 text-sm">고급 보안 기술을 필요로하는 매장</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">AI CCTV 4대</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">양방향 통화</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">이상 상황 감지</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">무인매장 보험 (1천만원)</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <i class="ri-check-line text-green-500"></i>
                            <span class="text-sm">프리미엄 앱 연동</span>
                        </li>
                    </ul>
                    <button onclick="partnerInquiry.showDialog('AI보안')" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        상담 신청하기
                    </button>
                </div>
            </section>

            <!-- 추가 혜택 -->
            <section class="px-4 py-8 bg-gray-50">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">🎁 추가 혜택</h2>
                    <p class="text-gray-600">모든 패키지에 기본 제공되는 혜택</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-2xl mb-2">🎁</div>
                        <p class="text-sm font-medium mb-1">악세서리 무상 제공</p>
                        <p class="text-xs text-gray-600">라벨프린터, 음성 안내 센서</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-2xl mb-2">🛡️</div>
                        <p class="text-sm font-medium mb-1">보상 보험 제공</p>
                        <p class="text-xs text-gray-600">도난/파손 보상</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-2xl mb-2">⚡</div>
                        <p class="text-sm font-medium mb-1">빠른 설치 지원</p>
                        <p class="text-xs text-gray-600">전국 설치 네트워크</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-2xl mb-2">📱</div>
                        <p class="text-sm font-medium mb-1">앱 연동 지원</p>
                        <p class="text-xs text-gray-600">실시간 모니터링</p>
                    </div>
                </div>
            </section>

            <!-- 참고사항 -->
            <section class="px-4 py-8 bg-white">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">📝 참고사항</h2>
                </div>
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-600">
                            • 기본 계약기간은 3년이며, 설치비 포함입니다.<br>
                            • 현장 상황에 따라 장비 추가 시 월 요금이 변동될 수 있습니다.<br>
                            • 실시간 원격 제어 및 무인매장 앱 연동 가능합니다.<br>
                            • 신용카드, 삼성페이, LG페이 등 다양한 인증 방식을 지원합니다.
                        </p>
                    </div>
                    <div class="text-center mt-6">
                        <a href="https://drive.google.com/file/d/1rsbL2xN9sLlD2TywpPr_jwJf3-smzpiA/view?usp=drive_link" 
                           target="_blank" 
                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="ri-file-download-line"></i>
                            <span>관련 자료 다운로드</span>
                        </a>
                    </div>
                </div>
            </section>
        </section>
        
        <div class="px-4 py-6 bg-gray-50 text-center text-sm text-gray-500">
            <p class="text-xs">© 2025 편편생활연구소. All rights reserved.</p>
        </div>
    </main>
    <footer class="fixed bottom-0 w-[375px] bg-white border-t">
        <div class="grid grid-cols-5 gap-0">
            <button id="home-btn" class="flex flex-col items-center justify-center py-2">
                <i class="ri-home-5-line text-lg"></i>
                <span class="text-xs mt-1">편편상회</span>
            </button>
            <button id="partnership-btn" class="flex flex-col items-center justify-center py-2">
                <i class="ri-book-open-line text-lg"></i>
                <span class="text-xs mt-1">파트너십</span>
            </button>
            <button id="security-btn" class="flex flex-col items-center justify-center py-2">
                <i class="ri-shield-check-line text-lg"></i>
                <span class="text-xs mt-1">안심솔루션</span>
            </button>
            <button class="flex flex-col items-center justify-center py-2 w-full" onclick="showContactDialog()">
                <i class="ri-customer-service-2-line text-lg"></i>
                <span class="text-xs mt-1">상담신청</span>
            </button>
            <button class="flex flex-col items-center justify-center py-2 w-full" onclick="showProgressDialog()">
                <i class="ri-search-line text-lg"></i>
                <span class="text-xs mt-1">상담현황</span>
            </button>
        </div>
    </footer>

    <!-- 진행 상황 확인 모달 -->
    <div id="progressModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white w-[320px] rounded-lg p-6">
            <h3 class="text-lg font-medium mb-4">진행 상황 확인</h3>
            <form id="progressCheckForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">핸드폰 번호</label>
                    <input type="text" id="phoneNumber" placeholder="숫자만 입력 (01012345678)"
                        class="mt-1 w-full px-4 py-2 border rounded" required maxlength="11"
                        oninput="this.value = this.value.replace(/[^0-9]/g, ''); validatePhoneNumber(this);">
                    <p class="text-xs text-gray-500 mt-1">'-' 없이 숫자만 입력해주세요</p>
                    <p id="phoneError" class="text-xs text-red-500 mt-1 hidden">핸드폰 번호 11자리를 입력해주세요</p>
                </div>
                <button type="submit" class="w-full py-3 bg-primary hover:bg-primary/90 text-white !rounded-button">
                    확인하기
                </button>
            </form>
            <button class="w-full py-2 mt-2 text-gray-500" onclick="closeProgressModal()">
                닫기
            </button>
        </div>
    </div>

    <!-- 진행 상황 상세 모달 -->
    <div id="progressDetailModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white w-[90%] max-w-[480px] rounded-lg max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-medium">신청 진행 상황</h3>
                <button onclick="closeProgressDetailModal()" class="text-gray-500">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>
            <div class="overflow-y-auto flex-1 p-6">
                <div id="progressDetail" class="space-y-4">
                    <!-- 진행 상황 내용이 여기에 동적으로 추가됨 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyCbu_1gbtSIVUvmmw5RyLYvjaYOG7RdCWw",
            authDomain: "ppap-ea44a.firebaseapp.com",
            projectId: "ppap-ea44a",
            storageBucket: "ppap-ea44a.firebasestorage.app",
            messagingSenderId: "811949338329",
            appId: "1:811949338329:web:cda8d43a7aeb825ce258c8",
            measurementId: "G-6QGZT6Y1TE"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // 유틸리티 함수
        const utils = {
            // 이미지 최적화 및 업로드
            async optimizeAndUploadImage(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = async () => {
                            const canvas = document.createElement('canvas');
                            const [MAX_WIDTH, MAX_HEIGHT] = [1200, 1200];
                            let [width, height] = [img.width, img.height];

                            if (width > height && width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            } else if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }

                            Object.assign(canvas, { width, height });
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            canvas.toBlob(async (blob) => {
                                try {
                                    // 저장 경로 개선: 날짜별 폴더 구조
                                    const now = new Date();
                                    const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
                                    const timeStr = now.getTime();
                                    const fileName = `${timeStr}_${file.name || 'image.jpg'}`;
                                    const fileRef = storage.ref().child(`franchise_inquiries/${dateStr}/${fileName}`);
                                    
                                    await fileRef.put(blob);
                                    const url = await fileRef.getDownloadURL();
                                    resolve(url);
                                } catch (error) {
                                    reject(error);
                                }
                            }, 'image/jpeg', 0.85);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            },

            // 활동 로그 기록
            async logActivity(action, data) {
                try {
                    await db.collection('activity_logs').add({
                        action,
                        data,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        userAgent: navigator.userAgent,
                        path: window.location.pathname
                    });
                } catch (error) {
                    console.error('로그 기록 실패:', error);
                }
            }
        };

        // 파트너 문의 관련 기능
        const partnerInquiry = {
            // 문의 제출
            async submit(formData) {
                try {
                    // 이미지 업로드 처리
                    let imageUrls = [];
                    if (formData.attachedImages && formData.attachedImages.length > 0) {
                        const uploadPromises = formData.attachedImages.map(async (imageData) => {
                            try {
                                const url = await utils.optimizeAndUploadImage(imageData.file);
                                return url;
                            } catch (error) {
                                console.error('이미지 업로드 실패:', error);
                                return null;
                            }
                        });
                        
                        imageUrls = (await Promise.all(uploadPromises)).filter(url => url !== null);
                    }

                    // Firestore에 저장할 데이터에서 파일 객체 제거
                    const { attachedImages, ...dataToSave } = formData;
                    
                    const docRef = await db.collection('franchise_inquiries').add({
                        ...dataToSave,
                        imageUrls: imageUrls,
                        status: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    await utils.logActivity('partner_inquiry_submit', {
                        inquiryId: docRef.id,
                        partnerType: formData.partnerType,
                        hasImages: imageUrls.length > 0,
                        imageCount: imageUrls.length
                    });

                    return docRef.id;
                } catch (error) {
                    console.error('문의 제출 실패:', error);
                    throw error;
                }
            },

            // 문의 다이얼로그 HTML
            getDialogHTML() {
                return `
            <div class="bg-white w-[320px] rounded-lg max-h-[90vh] flex flex-col">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-medium">파트너 상담 신청</h3>
                </div>
                <div class="flex-1 overflow-y-auto p-6">
                    <form id="partnerInquiryForm" class="space-y-1">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">파트너 유형</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center p-3 border rounded cursor-pointer hover:border-primary">
                                <input type="radio" name="partner-type" value="전속" class="mr-2" required>
                                <div>
                                    <div class="font-medium">전속 파트너</div>
                                    <div class="text-xs text-gray-500">신규 개설 A to Z 지원</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border rounded cursor-pointer hover:border-primary">
                                <input type="radio" name="partner-type" value="운영지원" class="mr-2">
                                <div>
                                    <div class="font-medium">운영 지원</div>
                                    <div class="text-xs text-gray-500">상품 납품 및 매장 관리 위탁 서비스</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">보안솔루션 패키지</label>
                        <div class="grid grid-cols-3 gap-2">
                            <label class="grid gap-1 items-center p-3 border rounded cursor-pointer hover:border-primary">
                                <input type="radio" name="security-package" value="기본보안" class="mr-2">
                                <span class="px-1 py-1 text-xs bg-blue-100 text-blue-600 rounded-full">24h관제</span>
                            </label>
                            <label class="grid gap-1 items-center p-3 border rounded cursor-pointer hover:border-primary">
                                <input type="radio" name="security-package" value="출입인증" class="mr-2">
                                <span class="px-1 py-1 text-xs bg-gray-100 text-gray-600 rounded-full">출입인증</span>
                            </label>
                            <label class="grid gap-1 items-center p-3 border rounded cursor-pointer hover:border-primary">
                                <input type="radio" name="security-package" value="AI보안" class="mr-2">
                                <span class="px-1 py-1 text-xs bg-purple-100 text-purple-600 rounded-full">AI 보안</span>
                            </label>
                        </div>
                    </div>

                    <label class="block text-sm font-medium text-gray-700">희망 파트너 정보</label>
                    <input type="text" placeholder="이름" required class="w-full px-4 py-2 border rounded">
                    <input type="tel" placeholder="연락처" required class="w-full px-4 py-2 border rounded">
                    <input type="text" placeholder="희망지역" required class="w-full px-4 py-2 border rounded">
                    
                    <!-- 추가 문의 사항 접기/펼치기 -->
                    <div class="border-t pt-4">
                        <button type="button" id="toggleAdditionalInfo" class="flex items-center justify-between w-full text-left text-sm font-medium text-gray-700 hover:text-primary transition-colors">
                            <span>📝 추가 문의 사항</span>
                            <i class="ri-arrow-down-s-line transition-transform" id="toggleIcon"></i>
                        </button>
                        <div id="additionalInfoSection" class="hidden mt-3 space-y-3">
                            <textarea id="additionalMessage" placeholder="추가로 궁금한 점이나 특별한 요청사항이 있으시면 자유롭게 작성해주세요." 
                                      class="w-full px-3 py-2 border rounded-lg resize-none" rows="3"></textarea>
                            
                            <!-- 사진 첨부 영역 -->
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">📷 사진 첨부 (최대 3장)</label>
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
                                        <div class="text-xs text-blue-800 font-medium mb-2">📸 촬영 가이드라인</div>
                                        <div class="text-xs text-blue-700 space-y-1">
                                            <div>• 매장 외부/내부 전경 1장</div>
                                            <div>• 희망하는 상품 구성 1장</div>
                                            <div>• 기타 참고사항 1장</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" id="cameraBtn" class="flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-colors">
                                        <i class="ri-camera-line text-lg"></i>
                                        <span class="text-sm">카메라</span>
                                    </button>
                                    <button type="button" id="galleryBtn" class="flex items-center justify-center gap-2 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-colors">
                                        <i class="ri-image-line text-lg"></i>
                                        <span class="text-sm">갤러리</span>
                                    </button>
                                </div>
                                
                                <!-- 첨부된 이미지 미리보기 -->
                                <div id="imagePreviewContainer" class="hidden">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="text-sm font-medium text-gray-700">첨부된 이미지</div>
                                        <div class="text-xs text-gray-500" id="imageCount">0/3</div>
                                    </div>
                                    <div id="imagePreviewList" class="grid grid-cols-3 gap-2">
                                        <!-- 이미지 미리보기가 여기에 추가됨 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                </div>
                <div class="p-6 border-t bg-gray-50">
                    <div class="flex gap-2">
                        <button type="button" class="px-6 py-3 text-gray-500 border border-gray-300 rounded-button hover:bg-gray-50" onclick="this.closest('.fixed').remove()">닫기</button>
                        <button type="submit" form="partnerInquiryForm" class="flex-1 py-3 bg-primary hover:bg-primary/90 text-white !rounded-button">신청하기</button>
                    </div>
                </div>
            </div>
        `;
            },

            // 다이얼로그 표시
            showDialog(selectedPackage = null) {
                const dialog = document.createElement('div');
                dialog.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                dialog.innerHTML = this.getDialogHTML();
                document.body.appendChild(dialog);

                // 선택된 패키지가 있으면 해당 라디오 버튼 선택
                if (selectedPackage) {
                    const radioButton = dialog.querySelector(`input[name="security-package"][value="${selectedPackage}"]`);
                    if (radioButton) {
                        radioButton.checked = true;
                    }
                }

                // 접기/펼치기 기능
                const toggleBtn = dialog.querySelector('#toggleAdditionalInfo');
                const additionalSection = dialog.querySelector('#additionalInfoSection');
                const toggleIcon = dialog.querySelector('#toggleIcon');
                
                toggleBtn.addEventListener('click', () => {
                    const isHidden = additionalSection.classList.contains('hidden');
                    if (isHidden) {
                        additionalSection.classList.remove('hidden');
                        toggleIcon.style.transform = 'rotate(180deg)';
                        
                        // 펼친 후 스크롤을 해당 섹션으로 부드럽게 이동
                        setTimeout(() => {
                            additionalSection.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'start' 
                            });
                        }, 100);
                    } else {
                        additionalSection.classList.add('hidden');
                        toggleIcon.style.transform = 'rotate(0deg)';
                    }
                });

                // 이미지 첨부 관련 변수
                let attachedImages = [];
                dialog.attachedImages = attachedImages; // dialog 객체에 참조 저장

                // 카메라 버튼 이벤트
                const cameraBtn = dialog.querySelector('#cameraBtn');
                cameraBtn.addEventListener('click', () => {
                    // 모바일 환경에서 카메라 접근 권한 확인
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        navigator.mediaDevices.getUserMedia({ video: true })
                            .then(() => {
                                const input = document.createElement('input');
                                input.type = 'file';
                                input.accept = 'image/*';
                                input.capture = 'environment'; // 후면 카메라 우선
                                input.addEventListener('change', (e) => {
                                    if (e.target.files && e.target.files[0]) {
                                        handleImageUpload(e.target.files[0], dialog, attachedImages);
                                    }
                                });
                                input.click();
                            })
                            .catch(() => {
                                alert('카메라 접근 권한이 필요합니다. 브라우저 설정에서 카메라 권한을 허용해주세요.');
                            });
                    } else {
                        // 권한 확인이 불가능한 경우 기본 방식 사용
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = 'image/*';
                        input.capture = 'environment';
                        input.addEventListener('change', (e) => {
                            if (e.target.files && e.target.files[0]) {
                                handleImageUpload(e.target.files[0], dialog, attachedImages);
                            }
                        });
                        input.click();
                    }
                });

                // 갤러리 버튼 이벤트
                const galleryBtn = dialog.querySelector('#galleryBtn');
                galleryBtn.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.multiple = true;
                    input.addEventListener('change', (e) => {
                        if (e.target.files) {
                            Array.from(e.target.files).forEach(file => {
                                handleImageUpload(file, dialog, attachedImages);
                            });
                        }
                    });
                    input.click();
                });

                // 폼 제출 이벤트 리스너
                const form = dialog.querySelector('#partnerInquiryForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const submitButton = form.querySelector('button[type="submit"]');
                    submitButton.disabled = true;

                    try {
                        const formData = {
                            name: form.querySelector('input[placeholder="이름"]').value,
                            phone: form.querySelector('input[placeholder="연락처"]').value,
                            location: form.querySelector('input[placeholder="희망지역"]').value,
                            partnerType: form.querySelector('input[name="partner-type"]:checked')?.value || '',
                            securityPackage: form.querySelector('input[name="security-package"]:checked')?.value || '',
                            additionalMessage: form.querySelector('#additionalMessage')?.value || '',
                            attachedImages: attachedImages
                        };

                        await this.submit(formData);
                        alert('문의가 성공적으로 접수되었습니다.');
                        dialog.remove();
                    } catch (error) {
                        alert('문의 접수 중 오류가 발생했습니다. 다시 시도해주세요.');
                        submitButton.disabled = false;
                    }
                });
            }
        };

        // 이미지 업로드 처리 함수
        function handleImageUpload(file, dialog, attachedImages) {
            // 파일 크기 제한 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('파일 크기는 5MB 이하여야 합니다.');
                return;
            }

            // 이미지 파일인지 확인
            if (!file.type.startsWith('image/')) {
                alert('이미지 파일만 첨부 가능합니다.');
                return;
            }

            // 최대 3개까지만 첨부 가능 (가이드라인 개선)
            if (attachedImages.length >= 3) {
                alert('최대 3개까지만 첨부 가능합니다.\n\n📸 가이드라인:\n• 매장 외부/내부 전경 1장\n• 희망하는 상품 구성 1장\n• 기타 참고사항 1장');
                return;
            }

            // 이미지 최적화 (높이 300px 기준)
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 높이 300px 기준으로 비율 유지하며 리사이즈
                    const targetHeight = 300;
                    const aspectRatio = img.width / img.height;
                    const targetWidth = Math.round(targetHeight * aspectRatio);
                    
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    
                    // 이미지 품질 향상을 위한 스무딩 설정
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    // 이미지 그리기
                    ctx.drawImage(img, 0, 0, targetWidth, targetHeight);
                    
                    // 최적화된 이미지를 JPEG로 변환 (품질 0.85)
                    canvas.toBlob((blob) => {
                        const imageData = {
                            file: blob,
                            preview: canvas.toDataURL('image/jpeg', 0.85),
                            id: Date.now() + Math.random(),
                            originalName: file.name,
                            optimizedSize: blob.size
                        };
                        
                        attachedImages.push(imageData);
                        updateImagePreview(dialog, attachedImages);
                        
                        // 최적화 결과 알림
                        const originalSize = file.size;
                        const optimizedSize = blob.size;
                        const reduction = Math.round((1 - optimizedSize / originalSize) * 100);
                        
                        if (reduction > 20) {
                            console.log(`이미지 최적화 완료: ${originalSize}KB → ${optimizedSize}KB (${reduction}% 감소)`);
                        }
                    }, 'image/jpeg', 0.85);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // 이미지 미리보기 업데이트
        function updateImagePreview(dialog, attachedImages) {
            const container = dialog.querySelector('#imagePreviewContainer');
            const list = dialog.querySelector('#imagePreviewList');
            const countElement = dialog.querySelector('#imageCount');
            
            if (attachedImages.length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            list.innerHTML = '';
            
            // 이미지 카운터 업데이트
            if (countElement) {
                countElement.textContent = `${attachedImages.length}/3`;
            }

            attachedImages.forEach((imageData, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'relative group';
                previewItem.innerHTML = `
                    <img src="${imageData.preview}" alt="첨부 이미지" 
                         class="w-full h-20 object-cover rounded-lg border">
                    <button type="button" onclick="removeImage(${imageData.id}, this)" 
                            class="absolute -top-2 -right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center text-sm hover:bg-red-600 transition-colors touch-manipulation">
                        <i class="ri-close-line"></i>
                    </button>
                    <div class="absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1 py-0.5 rounded">
                        ${Math.round(imageData.optimizedSize / 1024)}KB
                    </div>
                `;
                list.appendChild(previewItem);
            });
        }

        // 이미지 제거 함수
        function removeImage(imageId, button) {
            const dialog = button.closest('.fixed');
            const attachedImages = dialog.attachedImages || [];
            const index = attachedImages.findIndex(img => img.id === imageId);
            
            if (index > -1) {
                attachedImages.splice(index, 1);
                updateImagePreview(dialog, attachedImages);
            }
        }

        // 전역에서 접근 가능하도록 함수 설정
        window.showContactDialog = () => partnerInquiry.showDialog();
        window.removeImage = removeImage;

        // 지도 관련 기능
        let map, markers = [], infowindows = [];
        
        // 카카오맵 API 로드 상태 확인
        function isKakaoMapLoaded() {
            return typeof kakao !== 'undefined' && kakao.maps && typeof kakao.maps.Map === 'function';
        }
        
        // 매장 정보 데이터
        const storeData = {
            '복수점': {
                name: '편편상회 복수점',
                address: '대전 서구 복수동',
                description: '복수동 주민을 위한 무인 상점',
                hours: '24시간 무인운영<br/>(Break Time 04:00 ~ 06:00)',
                services: ['무인아이스크림', '세계과자', '뷰티용품', '간편식', '음료'],
                lat: 36.300632,
                lng: 127.379670,
                keywords: ['복수점', '복수동', '서구', '편편상회', '무인편의점', '아이스크림', '과자', '뷰티', '간편식', '음료'],
                mainImage: '/public/res/store01.png',
                images: []
            },
            '중촌연구소': {
                name: '편편상회 중촌연구소',
                address: '대전 중구 중촌로 15 중촌SK뷰아파트 상가동 105호',
                description: '중촌동 주민을 위한 무인 상점',
                hours: '24시간 무인운영',
                services: ['무인아이스크림', '세계과자', '뷰티용품', '간편식', '음료'],
                lat: 36.338753,
                lng: 127.409683,
                keywords: ['중촌연구소', '중구', '편편상회', '편편생활연구소', '본사', '무인편의점', '아이스크림', '과자', '뷰티', '간편식', '연구소'],
                mainImage: '/public/res/store02.png',
                images: []
            }
        };

        // 매장 선택 기능 개선
        function selectStore(storeKey) {
            const store = storeData[storeKey];
            if (!store) {
                console.warn('매장 정보를 찾을 수 없습니다:', storeKey);
                return;
            }

            // 지도가 초기화되지 않은 경우 처리
            if (!map || typeof map.panTo !== 'function') {
                console.warn('지도가 아직 초기화되지 않았습니다.');
                return;
            }

            // 좌표 유효성 검사
            if (!store.lat || !store.lng || isNaN(store.lat) || isNaN(store.lng)) {
                console.error('유효하지 않은 좌표:', store.lat, store.lng);
                return;
            }

            // 모든 버튼의 선택 상태 제거
            document.querySelectorAll('button[onclick*="selectStore"]').forEach(btn => {
                btn.className = 'px-6 py-3 bg-white border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200 font-medium';
            });

            // 선택된 버튼 강조 (간단한 스타일)
            const selectedButton = event.currentTarget;
            selectedButton.className = 'px-6 py-3 bg-primary/10 border-2 border-primary rounded-lg transition-all duration-200 font-medium text-primary';

            // 지도에서 해당 매장 위치로 정확히 이동 (더블 클릭 효과)
            try {
                if (!isKakaoMapLoaded()) {
                    console.warn('카카오맵 API가 로드되지 않았습니다.');
                    return;
                }
                
                const position = new kakao.maps.LatLng(store.lat, store.lng);
                
                // 첫 번째 이동: 빠른 이동
                map.panTo(position);
                
                // 두 번째 이동: 정확한 위치 설정 (더블 클릭 효과)
                setTimeout(() => {
                    map.setCenter(position);
                    map.setLevel(3); // 줌 레벨 조정
                    
                    // 세 번째 이동: 최종 위치 확인 (더블 클릭 효과 강화)
                    setTimeout(() => {
                        map.setCenter(position);
                    }, 100);
                }, 300);
                
            } catch (error) {
                console.error('지도 이동 중 오류:', error);
                return;
            }

            // 모든 마커를 기본 스타일로
            if (markers && markers.length > 0) {
                markers.forEach(marker => {
                    if (marker && typeof marker.setZIndex === 'function') {
                        marker.setZIndex(1);
                    }
                });

                // 선택된 매장의 마커만 강조 (인포윈도우는 열지 않음)
                const storeIndex = Object.keys(storeData).indexOf(storeKey);
                if (storeIndex >= 0 && markers[storeIndex]) {
                    markers[storeIndex].setZIndex(1000);
                    
                    // 기존에 열린 인포윈도우는 닫기
                    if (infowindows && infowindows.length > 0) {
                        infowindows.forEach(iw => {
                            if (iw && typeof iw.close === 'function') {
                                iw.close();
                            }
                        });
                    }
                }
            }

            console.log(`매장 선택: ${storeKey}, 위치: ${store.lat}, ${store.lng}`);
        }

        // 지도 초기화 개선
        function initMap() {
            const mapContainer = document.getElementById('map');
            if (!mapContainer) {
                console.warn('지도 컨테이너를 찾을 수 없습니다.');
                return;
            }

            // 카카오맵 API가 로드되었는지 확인
            if (!isKakaoMapLoaded()) {
                console.warn('카카오맵 API가 로드되지 않았습니다. 재시도 중...');
                setTimeout(initMap, 500); // 0.5초 후 재시도
                return;
            }

            try {
                const mapOption = {
                    center: new kakao.maps.LatLng(36.338753, 127.409683), // 중촌연구소 위치로 초기 중심 설정
                    level: 9
                };

                map = new kakao.maps.Map(mapContainer, mapOption);

                // 매장 마커 추가
                Object.keys(storeData).forEach(storeKey => {
                    const store = storeData[storeKey];
                    addMarker(store, storeKey);
                });

                console.log('지도가 성공적으로 초기화되었습니다.');
            } catch (error) {
                console.error('지도 초기화 중 오류 발생:', error);
                // 오류 발생 시 1초 후 재시도
                setTimeout(initMap, 1000);
            }
        }

        // 마커 추가
        function addMarker(store, storeKey) {
            const position = new kakao.maps.LatLng(store.lat, store.lng);
            const markerImage = new kakao.maps.MarkerImage(
                'data:image/svg+xml;base64,' + btoa(`
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" fill="#4CAF50" stroke="white" stroke-width="2"/>
                        <circle cx="20" cy="20" r="8" fill="white"/>
                    </svg>
                `),
                new kakao.maps.Size(40, 40)
            );

            const marker = new kakao.maps.Marker({
                position: position,
                map: map,
                title: store.name,
                image: markerImage
            });

            // 마커 클릭 시 바로 상세 모달 표시
            kakao.maps.event.addListener(marker, 'click', function() {
                showStoreDetailModal(storeKey);
            });

            markers.push(marker);
        }

        // 인포윈도우 내용 개선
        function createInfoWindowContent(store, storeKey) {
            return `
                <div class="p-4 max-w-xs text-center">
                    <div class="mb-3 font-bold text-base text-gray-800">${store.name}</div>
                    <div class="flex gap-2 justify-center">
                        <button onclick="showStoreDetailModal('${storeKey}')" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">상세보기</button>
                        <button onclick="navigateToStore('${storeKey}')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm">길찾기</button>
                    </div>
                </div>
            `;
        }

        // 매장 정보 모달 표시
        function showStoreInfo(storeKey) {
            const store = storeData[storeKey];
            if (!store) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white w-[320px] rounded-lg p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <div class="text-3xl">🏪</div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800">${store.name}</h3>
                            <p class="text-sm text-gray-600">${store.address}</p>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500">🕒</span>
                            <span>${store.hours}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500">📍</span>
                            <span>${store.description}</span>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h4 class="font-medium text-gray-700 mb-2">주요 상품</h4>
                        <div class="flex flex-wrap gap-1">
                            ${store.services.map(service => 
                                `<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded">${service}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="mt-6 flex gap-2">
                        <button onclick="navigateToStore('${storeKey}')" 
                                class="flex-1 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">
                            길찾기
                        </button>
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                            닫기
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // 길찾기 기능
        function navigateToStore(storeKey) {
            const store = storeData[storeKey];
            if (!store) return;

            // 카카오맵 길찾기 URL 생성
            const url = `https://map.kakao.com/link/to/${store.name},${store.lat},${store.lng}`;

            // 모바일/PC 구분
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

            if (isMobile) {
                // 모바일은 현재 창에서 바로 이동
                location.href = url;
            } else {
                // PC는 새 탭에서 열기
                window.open(url, '_blank');
            }
        }

        // 현재 열린 인포윈도우 닫기
        function closeCurrentInfoWindow() {
            if (infowindows && infowindows.length > 0) {
                infowindows.forEach(iw => {
                    if (iw && typeof iw.close === 'function') {
                        iw.close();
                    }
                });
                infowindows = [];
            }
        }

        // 엔터키로 검색
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('storeSearch');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        // 검색 기능 제거됨
                    }
                });
            }
        });

        // 전역 함수로 등록
        window.showStoreInfo = showStoreInfo;
        window.navigateToStore = navigateToStore;
        window.selectStore = selectStore;
        window.closeCurrentInfoWindow = closeCurrentInfoWindow;

        // 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', () => {
            // 지도 초기화 - 카카오맵 API 로드 완료 후 실행
            const initMapWithRetry = () => {
                if (typeof kakao !== 'undefined' && kakao.maps) {
                    initMap();
                } else {
                    console.log('카카오맵 API 로드 대기 중...');
                    setTimeout(initMapWithRetry, 100);
                }
            };
            
            // 지도 초기화 시작
            initMapWithRetry();

            // 스무스 스크롤
            document.querySelectorAll('.smooth-scroll').forEach(anchor => {
                anchor.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = anchor.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // 문의 버튼 이벤트 수정 부분
            document.querySelectorAll('button:not([onclick]):not(#partnership-btn)').forEach(button => {
                const text = button.textContent.trim().toLowerCase();
                if (text.includes('파트너') || text.includes('상담')) {
                    button.addEventListener('click', () => partnerInquiry.showDialog());
                }
            });

            // Swiper 초기화
            new Swiper('#mainSwiper', {
                loop: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false
                }
            });

            // 화면 전환 기능 추가///
            const homeBtn = document.getElementById('home-btn');
            const partnershipBtn = document.getElementById('partnership-btn');
            const securityBtn = document.getElementById('security-btn');
            const mainContent = document.getElementById('main-content');
            const partnershipContent = document.getElementById('partnership-content');
            const securityContent = document.getElementById('security-content');
            

            // 홈 버튼 클릭 이벤트
            homeBtn.addEventListener('click', () => {
                mainContent.classList.remove('hidden');
                partnershipContent.classList.add('hidden');
                securityContent.classList.add('hidden');
                // 활성화된 버튼 스타일 변경
                homeBtn.classList.add('text-primary');
                partnershipBtn.classList.remove('text-primary');
                securityBtn.classList.remove('text-primary');
                // 스크롤을 맨 위로 이동
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // 파트너십 버튼 클릭 이벤트
            partnershipBtn.addEventListener('click', () => {
                mainContent.classList.add('hidden');
                partnershipContent.classList.remove('hidden');
                securityContent.classList.add('hidden');
                // 활성화된 버튼 스타일 변경
                homeBtn.classList.remove('text-primary');
                partnershipBtn.classList.add('text-primary');
                securityBtn.classList.remove('text-primary');
                // 스크롤을 맨 위로 이동
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // 보안솔루션 버튼 클릭 이벤트
            securityBtn.addEventListener('click', () => {
                mainContent.classList.add('hidden');
                partnershipContent.classList.add('hidden');
                securityContent.classList.remove('hidden');
                // 활성화된 버튼 스타일 변경
                homeBtn.classList.remove('text-primary');
                partnershipBtn.classList.remove('text-primary');
                securityBtn.classList.add('text-primary');
                // 스크롤을 맨 위로 이동
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // 초기 상태 설정
            homeBtn.classList.add('text-primary');
        });

        // 진행 상황 확인 모달 관련 함수
        function showProgressDialog() {
            document.getElementById('progressModal').classList.remove('hidden');
        }

        function closeProgressModal() {
            document.getElementById('progressModal').classList.add('hidden');
        }

        function closeProgressDetailModal() {
            document.getElementById('progressDetailModal').classList.add('hidden');
        }

        // 진행 상황 확인 처리
        document.getElementById('progressCheckForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const phone = document.getElementById('phoneNumber').value;

            try {
                // 문의 조회
                const snapshot = await db.collection('franchise_inquiries')
                    .where('phone', '==', phone)
                    .get();

                if (snapshot.empty) {
                    alert('해당 번호로 신청된 내역이 없습니다.');
                    return;
                }

                // 클라이언트 측에서 정렬
                const docs = snapshot.docs.sort((a, b) =>
                    b.data().createdAt.toDate() - a.data().createdAt.toDate()
                );
                const data = docs[0].data();

                // 메시지 내역 조회 - 수정된 부분
                let messagesHtml = '';
                try {
                    const messagesSnapshot = await db.collection('inquiry_messages')
                        .where('inquiryId', '==', docs[0].id)
                        .orderBy('createdAt', 'desc')
                        .get()
                        .catch(async (error) => {
                            if (error.code === 'failed-precondition') {
                                // 인덱스가 없는 경우 메시지만 조회
                                const simpleMessagesSnapshot = await db.collection('inquiry_messages')
                                    .where('inquiryId', '==', docs[0].id)
                                    .get();
                                return simpleMessagesSnapshot;
                            }
                            throw error;
                        });

                    if (!messagesSnapshot.empty) {
                        const messages = messagesSnapshot.docs.sort((a, b) =>
                            b.data().createdAt.toDate() - a.data().createdAt.toDate()
                        );

                        messages.forEach(messageDoc => {
                            const messageData = messageDoc.data();
                            messagesHtml += `
                    <div class="bg-gray-50 rounded-lg p-4 mb-3">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-sm font-medium">담당자: ${messageData.adminId}</span>
                            <span class="text-xs text-gray-500">
                                ${new Date(messageData.createdAt.toDate()).toLocaleString()}
                            </span>
                        </div>
                        <div class="prose prose-sm max-w-none">
                            ${messageData.content}
                        </div>
                    </div>
                `;
                        });
                    } else {
                        messagesHtml = '<p class="text-sm text-gray-500 text-center">아직 상담 내역이 없습니다.</p>';
                    }
                } catch (error) {
                    console.error('메시지 조회 실패:', error);
                    messagesHtml = '<p class="text-sm text-red-500 text-center">메시지 조회 중 오류가 발생했습니다.</p>';
                }

                // 나머지 코드는 그대로 유지
                const statusTexts = {
                    'pending': '접수완료',
                    'checking': '확인중',
                    'consulting': '상담중',
                    'completed': '상담완료',
                    'canceled': '취소'
                };

                const progressDetail = document.getElementById('progressDetail');
                progressDetail.innerHTML = `
        <div class="space-y-6">
            <!-- 진행 단계 표시 -->
            <div class="flex justify-between items-center relative mb-2">
                <div class="absolute left-0 right-0 top-1/2 h-1 bg-gray-200 -z-10"></div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center ${data.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-500'}">
                        📝
                    </div>
                    <span class="text-xs mt-1">접수완료</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center ${data.status === 'checking' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-500'}">
                        🔍
                    </div>
                    <span class="text-xs mt-1">확인중</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center ${data.status === 'consulting' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-500'}">
                        💬
                    </div>
                    <span class="text-xs mt-1">상담중</span>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center ${data.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-500'}">
                        ✨
                    </div>
                    <span class="text-xs mt-1">상담완료</span>
                </div>
            </div>

            <!-- 현재 상태 표시 -->
            <div class="bg-gray-50 p-3 rounded-lg text-center">
                <p class="text-sm text-gray-600">현재 진행 상태</p>
                <div class="mt-2">
                    <span class="px-3 py-1.5 text-sm font-medium rounded-full inline-flex items-center gap-1.5 ${getStatusColor(data.status)}">
                        ${data.status === 'pending' ? '📝' :
                        data.status === 'checking' ? '🔍' :
                            data.status === 'consulting' ? '💬' :
                                data.status === 'completed' ? '✨' : '❌'}
                        ${statusTexts[data.status] || data.status}
                    </span>
                </div>
            </div>

            <!-- 신청 정보 -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">신청자명</label>
                    <p class="mt-1 flex items-center gap-2">
                        <span class="text-lg">👤</span>
                        ${data.name}
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">연락처</label>
                    <p class="mt-1 flex items-center gap-2">
                        <span class="text-lg">📱</span>
                        ${data.phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3')}
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">희망지역</label>
                    <p class="mt-1 flex items-center gap-2">
                        <span class="text-lg">📍</span>
                        ${data.location}
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">파트너 유형</label>
                    <p class="mt-1 flex items-center gap-2">
                        <span class="text-lg">🤝</span>
                        ${data.partnerType}
                    </p>
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700">신청일시</label>
                    <p class="mt-1 flex items-center gap-2">
                        <span class="text-lg">📅</span>
                        ${new Date(data.createdAt.toDate()).toLocaleString()}
                    </p>
                </div>
            </div>

            <!-- 상담 메시지 표시 -->
            <div class="mt-6">
                <h4 class="text-sm font-medium text-gray-700 mb-3">상담 내역</h4>
                <div id="messageHistory" class="space-y-4">
                    ${messagesHtml}
                </div>
            </div>

            <!-- 안내 메시지 -->
            <div class="mt-4 text-center space-y-4">
                <p class="text-sm text-gray-600">
                    추가 문의사항은 고객센터(dev.chanwoo@gmail.com)로 연락주세요
                </p>
                ${data.status !== 'canceled' ? `
                <div class="border-t pt-4">
                    <div class="flex gap-2 justify-center">
                        <button onclick="cancelInquiry('${docs[0].id}')" 
                                class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">
                            상담 취소
                        </button>
                        <button onclick="closeProgressDetailModal()" 
                                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">
                            닫기
                        </button>
                    </div>
                </div>
                ` : ''}
            </div>
        </div>
    `;

                // 진행 상황 모달 전환
                document.getElementById('progressModal').classList.add('hidden');
                document.getElementById('progressDetailModal').classList.remove('hidden');
            } catch (error) {
                console.error('진행 상황 조회 실패:', error);
                alert('진행 상황을 조회하는데 실패했습니다. 잠시 후 다시 시도해주세요.');
            }
        });

        // 신청 취소 처리 함수 추가
        async function cancelInquiry(docId) {
            if (!confirm('상담 신청을 취소하시겠습니까?\n취소 후에는 되돌릴 수 없습니다.')) {
                return;
            }

            try {
                await db.collection('franchise_inquiries').doc(docId).update({
                    status: 'canceled',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // 활동 로그 기록
                await utils.logActivity('cancel_inquiry', {
                    inquiryId: docId,
                    action: 'user_canceled'
                });

                alert('상담 신청이 취소되었습니다.');
                closeProgressDetailModal();
            } catch (error) {
                console.error('신청 취소 실패:', error);
                alert('신청 취소 처리에 실패했습니다. 고객센터로 문의해주세요.');
            }
        }

        function getStatusColor(status) {
            const colors = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'checking': 'bg-blue-100 text-blue-800',
                'consulting': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'canceled': 'bg-red-100 text-red-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function validatePhoneNumber(input) {
            const errorElement = document.getElementById('phoneError');
            if (input.value.length !== 11) {
                errorElement.classList.remove('hidden');
                input.setCustomValidity('핸드폰 번호 11자리를 입력해주세요');
            } else {
                errorElement.classList.add('hidden');
                input.setCustomValidity('');
            }
        }

        // 상세 모달(레이어팝업) 구현
        function showStoreDetailModal(storeKey) {
            const store = storeData[storeKey];
            if (!store) return;

            const servicesHtml = (store.services || []).map(service => 
                `<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mr-1 mb-1">${service}</span>`
            ).join('');

            const modalHTML = `
                <div id="storeDetailModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50">
                    <div class="bg-white w-full max-w-[375px] mx-auto rounded-xl shadow-lg overflow-hidden max-h-[95vh] flex flex-col">
                        <div class="relative">
                            <img src="${store.mainImage}" alt="대표 이미지" class="w-full h-[260px] object-cover"/>
                            <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/70 to-transparent px-4 py-3">
                                <div class="text-white text-lg font-bold drop-shadow">${store.name}</div>
                            </div>
                            <button onclick="closeStoreDetailModal()" class="absolute top-3 right-3 bg-black/60 text-white rounded-full w-9 h-9 flex items-center justify-center hover:bg-black/80">
                                <i class="ri-close-line text-2xl"></i>
                            </button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-5 bg-white">
                            <div class="mb-3 text-gray-700 font-semibold flex items-center gap-2">
                                <i class="ri-map-pin-line text-lg text-primary"></i> ${store.address}
                            </div>
                            <div class="mb-3 text-gray-600 text-sm">${store.description}</div>
                            <div class="mb-3 text-sm flex items-center gap-2">
                                <span class="font-medium text-gray-700">🕒</span> <span>${store.hours}</span>
                            </div>
                            <div class="mb-4">
                                <div class="font-medium text-gray-700 mb-1">주요 상품</div>
                                <div class="flex flex-wrap gap-1">${servicesHtml}</div>
                            </div>
                        </div>
                        <div class="p-4 border-t bg-gray-50 flex gap-2">
                            <button onclick="navigateToStore('${storeKey}')" class="flex-1 py-3 bg-primary text-white rounded-lg hover:bg-primary/90">길찾기</button>
                            <button onclick="closeStoreDetailModal()" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">닫기</button>
                        </div>
                    </div>
                </div>
            `;
            // 기존 모달 제거 후 새로 추가
            const existing = document.getElementById('storeDetailModal');
            if (existing) existing.remove();
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        window.showStoreDetailModal = showStoreDetailModal;
        function closeStoreDetailModal() {
            const modal = document.getElementById('storeDetailModal');
            if (modal) modal.remove();
        }
        window.closeStoreDetailModal = closeStoreDetailModal;
    </script>
</body>

</html>